<!DOCTYPE html>
<html>
<head>
	<title>{% block title %}Welcome{% endblock %} | MiniTwit</title>
	<meta charset="utf-8">
	<link rel="shortcut icon" href="{{url_for('static', filename='ico/favicon.ico')}}" />
	<link rel="apple-touch-icon-precomposed" href="{{url_for('static', filename='ico/apple-touch-icon.png')}}" />
	<meta property="og:image" content="{{url_for('static', filename='ico/thumbnail.png')}}" />
	
	<script src="{{url_for('static', filename='js/modernizr.js')}}"></script>
	<script src="{{url_for('static', filename='js/jquery.js')}}"></script>
	<script src="{{url_for('static', filename='js/bootstrap.min.js')}}"></script>
	<script src="{{url_for('static', filename='js/custom.js')}}"></script>
	<script src="{{url_for('static', filename='js/bootbox.min.js')}}"></script>
	
	<link rel="stylesheet" href="{{url_for('static', filename='css/bootstrap.css')}}">
	<link rel="stylesheet" href="{{url_for('static', filename='css/bootstrap-theme.min.css')}}"> 
	<link rel="stylesheet" href="{{url_for('static', filename='css/custom.css')}}">
	<style>
		.list-group-item:hover { background-color:#F0F4F8; }
		.list-group-item { cursor: pointer; cursor: hand; }
		body { background-image: url('static/img/yotsuba.jpg'); }
		#user_detail {padding: 10px;}
	</style>
</head>
<body>
	<div id="master-wrap">
		<header class="navbar">
		  <div class="navbar navbar-default navbar-fixed-top" role="navigation">
		      <div class="container">
		        <div class="navbar-header">
		          <a class="navbar-brand" href="{{url_for('landing')}}">MiniTwit</a>
		        </div>
		        <div class="navbar-collapse collapse">
		          <ul class="nav navbar-nav">
		            <li><a id="twit_menu" href="{{url_for('public_timeline')}}"><span class="glyphicon glyphicon-home"></span>Public Timeline</a></li>
		            <li><a id="my_timeline" href="{{url_for('my_timeline')}}"><span class="glyphicon glyphicon-user"></span>My Timeline</a></li>		            
		          </ul>
		          <ul class="nav navbar-nav navbar-right">
		          	<li><a id="twit_message" href="#"><span class="glyphicon glyphicon-edit"></span>트윗</a></li>
		          	{% if not g.user %}		            
		          	<li><a id="signup" href="{{url_for('signup')}}"><span class="glyphicon glyphicon-off"></span>회원가입</a></li>
		          	<li class="dropdown">
		            	<a id="signin" class="dropdown-toggle" data-toggle="dropdown" href="./"><span class="glyphicon glyphicon-cog"></span>로그인<b class="caret"></b></a>
		            	<div class="dropdown-menu">
		            		<form style="margin: 0px" accept-charset="UTF-8" action="{{url_for('signin')}}" method="post">
		            			<div style="margin:0;padding:0;display:inline">
			            			<input name="utf8" type="hidden" value="&#x2713;" />
			            			<input name="authenticity_token" type="hidden" value="4L/A2ZMYkhTD3IiNDMTuB/fhPRvyCNGEsaZocUUpw40=" />
		            			</div>
		            			<fieldset class='textbox' style="padding:10px">
			            			<input style="margin-top: 8px" type="text" name="username" placeholder="Username" />
			            			<input style="margin-top: 8px" type="password" name="password" placeholder="Passsword" />
			            			<input class="btn-primary" name="commit" type="submit" value="Log In" />
		            			</fieldset>
		            		</form>
		            	</div>		            	
		            </li>		       
		            {% else %}   			          
		            <li><a id="singout" href="{{url_for('signout')}}"><span class="glyphicon glyphicon-off"></span>로그아웃</a></li>
		            {% endif %}
		           </ul>
		        </div><!--/.nav-collapse -->
		      </div>
		    </div>
		</header>
	    
		<div class="main-content">
			<div class="container">
				<div class="row">
					<div class="col-sm-4">
						<div class="panel panel-primary">
							<div class="panel-heading">
								<h3 id="user_info" class="panel-title"></h3>
							</div>
			            	<div class="panel-body">
			            		{% if g.user %}
			            		<a class="pull-left" href="#">
									<img class="media-object" src="{{ g.user.email|gravatar(size=48) }}" alt="">
								</a>
								{% endif %}
								<span id="user_detail" ></span>
			            	</div>
						</div>
						<div>
							<form id="twit_form" class="form-horizontal">
								<textarea id="message" name="message" rows="4" class="form-control" placeholder="트윗 메시지"></textarea>
		        				<button id="twit_btn" class="btn btn-small btn-primary" type="submit">트윗</button>
							</form>
						</div>
					</div>
				    <div class="col-sm-8">
						<div class="list-group">
							<div class="list-group-item active">
							{% if request.endpoint == 'user_timeline' %}
								{{profile_user.username}}의 트윗
							{% elif request.endpoint == 'public_timeline' %}
								전체 트윗
							{% elif request.endpoint == 'my_timeline' %}
								나와 친구들의 트윗							
							{% endif %} 
							</div>
							{% if g.user %}
								{% if request.endpoint == 'user_timeline' %}
								<div class="alert alert-warning">
									{% if g.user.username == profile_user.username %}
										당신의 타임라인입니다.
									{% elif followed %}
										'{{profile_user.username}}'님을 팔로우하고 있습니다. 
										<button id="unfollow" class="btn btn-small btn-primary">팔로우 해제</button>
									{% else %}
										'{{profile_user.username}}'님을 아직 팔로우하고 있지 않습니다. 
										<button id="follow" class="btn btn-small btn-primary">팔로우</button>									
									{% endif %}										
								</div>							
								{% endif %}
							{% endif %}
							
							{% block twit %} 
							{% endblock %}
						</div>
					</div>
				</div>
			</div>
		</div><!-- /.main-content -->	
	</div>
	
	<form id="follow_form">
	</form>
	
<script type="text/javascript">
	$(document).ready(function() {			
	{% if request.endpoint == 'user_timeline' %}
		$('#follow').click(function() {
			bootbox.confirm('사용자를 팔로우하시겠습니까?', 
				function(response) {
					if (!response) return;
					$('#follow_form')
						.attr({'method':'post', 'action':'{{url_for("follow_user", username=profile_user.username)}}'})
						.submit();
			});
		});
				
		$('#unfollow').click(function() {
			bootbox.confirm('사용자를 팔로우하지 않겠습니까?', 
				function(response) {
					if (!response) return;
					$('#follow_form')
						.attr({'method':'post', 'action':'{{url_for("unfollow_user", username=profile_user.username)}}'})
						.submit();
			});
		});				
	{% endif %}
		
	{% if not g.user %}
		$('#user_info').text('손님이십니다');
		$('#user_detail').text('로그인해 주세요');
		$('#twit_message').click(function() {
			return false;
		});
		$('#message').attr('disabled', true);
		$('#twit_btn').attr('disabled', true);
	{% else %}	
		$('#signin').hide();
		$('#user_info').text('{{g.user.username}}');
		$('#user_detail').text('이메일 : {{g.user.email}}');
		$('#twit_message').click(function(event){
			bootbox.prompt('트윗할 메시지를 작성하세요', 
				function(data) {
					if (data != null) {
						$('#message').val(data);
						$('#twit_form').submit();
					}
			});
		});
	{% endif %}
			
		$('#twit_form').attr({'method':'post', 'action':'{{url_for("addMessage")}}' });
	});
</script>	
</body>
</html>